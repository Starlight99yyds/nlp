# 系统架构说明

## 🏗️ 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                     前端层 (React)                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ 首页     │  │ 分析页面 │  │ 生成页面 │  │ 推荐页面 │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────┘
                          │
                          │ HTTP/REST API
                          ▼
┌─────────────────────────────────────────────────────────┐
│                    API层 (Flask)                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │分析API   │  │生成API   │  │推荐API   │  │用户API   │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────┘
                          │
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   服务层 (Services)                       │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐              │
│  │分析服务  │  │生成服务  │  │推荐服务  │              │
│  └──────────┘  └──────────┘  └──────────┘              │
└─────────────────────────────────────────────────────────┘
                          │
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                  NLP引擎层 (nlp_engine)                   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐              │
│  │情感分析  │  │主题提取  │  │韵律分析  │              │
│  └──────────┘  └──────────┘  └──────────┘              │
│  ┌──────────┐  ┌──────────┐                            │
│  │歌词生成  │  │推荐系统  │                            │
│  └──────────┘  └──────────┘                            │
└─────────────────────────────────────────────────────────┘
                          │
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   数据层 (SQLite)                         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐              │
│  │用户表    │  │分析历史  │  │生成历史  │              │
│  └──────────┘  └──────────┘  └──────────┘              │
└─────────────────────────────────────────────────────────┘
```

## 📦 模块说明

### 前端模块

#### 页面组件 (`src/pages/`)
- **HomePage.js**: 首页，功能概览和导航
- **AnalysisPage.js**: 基础分析页面，展示情感、主题、韵律分析结果
- **GenerationPage.js**: 创作助手页面，提供多种生成和优化功能
- **RecommendationPage.js**: 智能推荐页面，展示推荐结果
- **HistoryPage.js**: 历史记录页面，查看所有操作历史

#### 布局组件 (`src/components/`)
- **MainLayout.js**: 主布局组件，包含侧边栏导航和内容区域

#### 服务层 (`src/services/`)
- **api.js**: API调用封装，统一管理所有后端接口

### 后端模块

#### API路由 (`app/api/`)
- **analysis.py**: 分析相关API
- **generation.py**: 生成相关API
- **recommendation.py**: 推荐相关API
- **user.py**: 用户相关API

#### 服务层 (`app/services/`)
- **analysis_service.py**: 分析业务逻辑
- **generation_service.py**: 生成业务逻辑
- **recommendation_service.py**: 推荐业务逻辑

#### NLP引擎 (`nlp_engine/`)
- **sentiment/**: 情感分析模块
- **theme/**: 主题提取模块
- **rhythm/**: 韵律分析模块
- **generation/**: 歌词生成模块
- **recommendation/**: 推荐系统模块

#### 数据模型 (`app/models/`)
- **user.py**: 用户模型
- **analysis.py**: 分析历史、生成历史、推荐历史模型

## 🔄 数据流

### 分析流程
```
用户输入歌词 
  → 前端发送POST请求 
  → API路由接收 
  → 分析服务调用NLP引擎 
  → 情感分析 + 主题提取 + 韵律分析 
  → 整合结果返回 
  → 前端展示可视化图表
```

### 生成流程
```
用户选择参数（主题/风格/情感）
  → 前端发送POST请求
  → API路由接收
  → 生成服务调用生成器
  → 生成歌词
  → 保存历史记录
  → 返回结果给前端
```

### 推荐流程
```
用户输入查询歌词
  → 前端发送POST请求
  → API路由接收
  → 推荐服务计算相似度
  → 生成推荐理由
  → 返回推荐列表
  → 前端展示推荐结果
```

## 🗄️ 数据库设计

### 用户表 (users)
- id: 主键
- username: 用户名
- email: 邮箱
- created_at: 创建时间
- preferences: 用户偏好（JSON）

### 分析历史表 (analysis_history)
- id: 主键
- user_id: 用户ID（外键）
- lyrics: 歌词内容
- sentiment_result: 情感分析结果（JSON）
- theme_result: 主题分析结果（JSON）
- rhythm_result: 韵律分析结果（JSON）
- created_at: 创建时间

### 生成历史表 (generation_history)
- id: 主键
- user_id: 用户ID（外键）
- prompt: 提示词
- generated_lyrics: 生成的歌词
- style: 风格
- created_at: 创建时间

### 推荐历史表 (recommendation_history)
- id: 主键
- user_id: 用户ID（外键）
- query_lyrics: 查询歌词
- recommendations: 推荐结果（JSON）
- created_at: 创建时间

## 🔐 安全考虑

1. **CORS配置**: 已启用跨域支持（开发环境）
2. **输入验证**: API层进行基本参数验证
3. **错误处理**: 统一的错误响应格式
4. **SQL注入防护**: 使用SQLAlchemy ORM防止SQL注入

## 🚀 性能优化

1. **数据库索引**: 在user_id和created_at字段上建立索引
2. **缓存策略**: 可添加Redis缓存常用分析结果
3. **异步处理**: 可考虑使用Celery处理耗时任务
4. **分页查询**: 历史记录支持分页加载

## 📈 扩展性

### 水平扩展
- 后端可部署多个实例，使用负载均衡
- 数据库可迁移到PostgreSQL/MySQL
- 添加Redis缓存层

### 功能扩展
- 集成更强大的NLP模型（BERT、GPT等）
- 添加用户认证和授权
- 实现实时协作功能
- 支持多语言歌词分析







